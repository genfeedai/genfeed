# Session: 2026-01-19

## Session 1: Environment File Cleanup + Codebase Cleanup

### Summary
Two cleanup tasks completed:
1. Consolidated environment files to single source of truth per app
2. Full codebase cleanup (imports, console.log → logger, dead code check)

---

### Task 1: Environment File Cleanup

#### Problem
Project had redundant env files:
- Root `/.env` and `/.env.example` (unused by apps)
- `apps/api/.env` (used by NestJS)
- `apps/web/.env.local` (used by Next.js)

Scripts were updating both root and app-specific files.

#### Solution
- Deleted root `.env` and `.env.example`
- Updated scripts to read from `apps/api/.env` only
- Added missing variables to `apps/api/.env.example`

#### Files Deleted
```
.env           # Redundant
.env.example   # Redundant
```

#### Files Modified
```
scripts/dev-tunnel.ts              # Only updates apps/api/.env now
scripts/sync-replicate-schemas.ts  # Loads env from apps/api/.env explicitly
apps/api/.env.example              # Added STORAGE_ADAPTER, SQLITE_PATH
```

#### New Structure
| App | Env File |
|-----|----------|
| API (NestJS) | `apps/api/.env` |
| Web (Next.js) | `apps/web/.env.local` |
| Scripts | Load from `apps/api/.env` |

---

### Task 2: Codebase Cleanup (/clean all)

#### Imports
- Biome auto-fixed useless switch case in `ffmpeg.service.ts`
- Biome auto-fixed optional chain patterns in `ffmpeg.service.ts`

#### Console.log → Logger

**API (2 files):**
- `main.ts` - `console.log` → `Logger.log`
- `worker.main.ts` - `console.error` → `Logger.error`

**Web (15 files):**
| File | Change |
|------|--------|
| `api/tweet/fetch/route.ts` | → `logger.error` |
| `api/tweet/remix/route.ts` | → `logger.error` |
| `api/video/process/route.ts` | → `logger.error` |
| `api/tools/grid-split/route.ts` | → `logger.error` |
| `api/rss/fetch/route.ts` | → `logger.error` |
| `api/status/[id]/route.ts` | → `logger.error` |
| `api/ai/generate-workflow/route.ts` | → `logger.error` |
| `api/replicate/webhook/route.ts` | → `logger.error` |
| `api/replicate/video/route.ts` | → `logger.error` |
| `api/replicate/lipsync/route.ts` | → `logger.error` |
| `api/replicate/llm/route.ts` | → `logger.error` |
| `api/replicate/image/route.ts` | → `logger.error` |
| `components/prompt-library/CreatePromptModal.tsx` | → `logger.error` |
| `components/models/ModelBrowserModal.tsx` | → `logger.error` |
| `store/promptLibraryStore.ts` | → `logger.error` |

#### Any Types
- No `any` types in production code (only in test files with explicit disable comments)

#### Dead Code
- No significant dead code detected

---

### Patterns Established

1. **Environment files**: One source of truth per app, scripts load from `apps/api/.env`
2. **Error logging**: Use `logger.error(message, error, { context })` format in web app
3. **NestJS logging**: Use `new Logger(ContextName)` pattern

---

## Session 2: Define OSS Core Scope

### Summary

Defined the boundary between OSS Core and Genfeed Cloud. The OSS version focuses on **media generation and processing** while Cloud handles **social publishing and content aggregation**.

### Scope Decisions

| Feature | OSS | Cloud |
|---------|-----|-------|
| Visual workflow editor | ✅ | ✅ |
| Queue-based execution | ✅ | ✅ |
| Real-time SSE updates | ✅ | ✅ |
| Gallery asset management | ✅ | ✅ |
| Templates (10 total) | ✅ | ✅ |
| Replicate provider | ✅ | ✅ |
| FAL.ai provider | ❌ | ✅ |
| HuggingFace provider | ❌ | ✅ |
| Social publishing | ❌ | ✅ |
| RSS/Twitter feeds | ❌ | ✅ |

### OSS Node Count: 26 nodes

**Input (5)**: imageInput, audioInput, videoInput, prompt, template

**AI (7)**: imageGen, videoGen, llm, lipSync, voiceChange, textToSpeech, transcribe

**Processing (12)**: resize, animation, videoStitch, videoTrim, videoFrameExtract, lumaReframeImage, lumaReframeVideo, topazImageUpscale, topazVideoUpscale, imageGridSplit, annotation, **subtitle (NEW)**

**Output (2)**: output, preview

### Cloud-Only Nodes (4)

Moved to `cloud/packages/`:
- `socialPublish` - Multi-platform video publishing
- `rssInput` - RSS feed aggregation
- `tweetInput` - Twitter content fetching
- `tweetRemix` - AI tweet variation generation

### Implementation Completed

1. **Phase 0: Subtitle Node Implementation**
   - Added types to `packages/types/src/nodes.ts`
   - Created `SubtitleNode.tsx` component
   - Added FFmpeg subtitle burning service
   - Added job processor for subtitle node

2. **Phase 1: Move Cloud Nodes**
   - Copied node components to `cloud/packages/ui/workflow-builder/nodes/`
   - Created type definitions in `cloud/packages/workflow-saas/src/nodes/`
   - Updated exports in index files
   - Removed cloud nodes from core

3. **Phase 2: Remove Excluded Providers**
   - Deleted `fal.service.ts` and `huggingface.service.ts`
   - Updated `providers.module.ts` and `providers.controller.ts`
   - Removed test spec files

4. **Phase 3: Update Templates**
   - Updated `stream-to-social.ts`: Removed 3 socialPublish nodes, simplified to output
   - Updated `youtube-video-generator.ts`: Removed youtubeUpload placeholder, connected subtitle → output

5. **Phase 4: Cloud Documentation**
   - Created `cloud/.agent/TASKS/workflow-nodes-migration.md`
   - Created `cloud/.agent/PRDS/cloud-workflow-nodes.md`

### Files Modified

**Core (types)**:
- `packages/types/src/nodes.ts` - Removed cloud types, added subtitle types

**Core (components)**:
- `apps/web/src/components/nodes/processing/SubtitleNode.tsx` (new)
- `apps/web/src/components/nodes/processing/index.ts` (updated)
- `apps/web/src/components/nodes/index.ts` (updated)
- `apps/web/src/components/nodes/input/index.ts` (updated)
- `apps/web/src/components/nodes/output/index.ts` (updated)
- `apps/web/src/components/nodes/ai/index.ts` (updated)

**Core (deleted)**:
- `apps/web/src/components/nodes/input/RssInputNode.tsx`
- `apps/web/src/components/nodes/input/TweetInputNode.tsx`
- `apps/web/src/components/nodes/output/SocialPublishNode.tsx`
- `apps/web/src/components/nodes/ai/TweetRemixNode.tsx`
- `apps/web/src/app/api/rss/` (directory)
- `apps/web/src/app/api/tweet/` (directory)
- `apps/api/src/providers/fal.service.ts`
- `apps/api/src/providers/huggingface.service.ts`
- `apps/api/src/providers/*.spec.ts`

**Core (backend)**:
- `apps/api/src/ffmpeg/ffmpeg.service.ts` (updated)
- `apps/api/src/queue/interfaces/job-data.interface.ts` (updated)
- `apps/api/src/queue/processors/processing.processor.ts` (updated)
- `apps/api/src/providers/providers.module.ts` (updated)
- `apps/api/src/providers/providers.controller.ts` (updated)

**Core (templates)**:
- `apps/web/src/templates/generated/stream-to-social.ts` (updated)
- `apps/web/src/templates/generated/youtube-video-generator.ts` (updated)
- `apps/web/src/templates/index.ts` (updated)

**Cloud (new)**:
- `packages/ui/workflow-builder/nodes/SocialPublishNode.tsx`
- `packages/ui/workflow-builder/nodes/RssInputNode.tsx`
- `packages/ui/workflow-builder/nodes/TweetInputNode.tsx`
- `packages/ui/workflow-builder/nodes/TweetRemixNode.tsx`
- `packages/workflow-saas/src/nodes/social-publish.ts`
- `packages/workflow-saas/src/nodes/rss-input.ts`
- `packages/workflow-saas/src/nodes/tweet-input.ts`
- `packages/workflow-saas/src/nodes/tweet-remix.ts`
- `packages/workflow-saas/src/nodes/index.ts` (updated)
- `.agent/TASKS/workflow-nodes-migration.md`
- `.agent/PRDS/cloud-workflow-nodes.md`

### Next Steps for Cloud

1. Configure TypeScript/JSX for workflow-builder package
2. Register nodes in workflow builder's node registry
3. Create API routes for RSS and tweet fetching
4. Implement OAuth integrations for social platforms
5. Add job processors for tweetRemix and socialPublish

---
