# Session: 2026-01-16

## Session 1: Templates Modal + Welcome Modal Implementation

### Summary
Continued implementing the approved plan for Templates Modal + Welcome Modal + Settings simplification. Session was a continuation from context compaction.

### Tasks Completed

1. **Added `hasSeenWelcome` to settingsStore**
   - Added to store state initialization
   - Updated `saveToStorage()` to persist the flag
   - Implemented `setHasSeenWelcome()` action

2. **Simplified SettingsModal**
   - Removed Providers tab (API key inputs)
   - Now only has "Defaults" and "Appearance" tabs
   - Added API configuration section with `.env` instructions showing required env vars

3. **Wired up modals in page.tsx**
   - Imported `WelcomeModal` and `TemplatesModal`
   - Added `useEffect` to show welcome modal on first visit (`!hasSeenWelcome`)
   - Rendered both modal components

4. **Fixed TemplatesModal always-open bug**
   - Added `isOpen = activeModal === 'templates'` check
   - Added early return `if (!isOpen) return null`
   - Fixed useEffect to only fetch when modal is open
   - Added `isOpen` to dependency array

### Files Modified

| File | Change |
|------|--------|
| `apps/web/src/store/settingsStore.ts` | Added `hasSeenWelcome` state, persistence, and action |
| `apps/web/src/components/settings/SettingsModal.tsx` | Removed Providers tab, added .env instructions |
| `apps/web/src/app/page.tsx` | Wired up WelcomeModal and TemplatesModal |
| `apps/web/src/components/templates/TemplatesModal.tsx` | Fixed always-open bug with `isOpen` check |

### Files Created (Previous Session)
- `apps/web/src/components/welcome/WelcomeModal.tsx`
- `apps/web/src/components/templates/TemplatesModal.tsx`
- `apps/web/src/components/ui/tooltip.tsx`

### Patterns Used

1. **Modal visibility pattern**: Check `activeModal === 'modalName'` and return `null` if not open
2. **Zustand persistence pattern**: Update both store state and `saveToStorage()` function signature
3. **First-visit detection**: Use persisted boolean flag + useEffect to show onboarding

### Decisions Made

| Decision | Rationale |
|----------|-----------|
| Remove API key inputs from Settings | API keys should be in .env, not browser localStorage |
| Node Banana-style welcome modal | User preference over Weavy workspace style |
| Show .env instructions in Settings | Help users understand how to configure API keys |

### Bugs Fixed

- **TemplatesModal always open**: Missing `isOpen` check before rendering JSX

### Next Steps (if continuing)
- Test the complete flow: first visit → welcome modal → templates → load workflow
- Verify localStorage persistence of `hasSeenWelcome`

---

## Session 2: Node Palette Close Button + AudioInputNode + Auto-Layout Feature

### Summary
Added close button to node palette, created missing AudioInputNode component, and implemented auto-layout feature using dagre.

### Tasks Completed

#### 1. Added Close Button to Node Palette
- **File Modified**: `apps/web/src/components/panels/NodePalette.tsx`
- **Changes**:
  - Added `X` icon import from lucide-react
  - Added `useUIStore` import to get `togglePalette`
  - Added close button in header matching ConfigPanel pattern
- **Pattern Used**: Same as ConfigPanel close button implementation

#### 2. Created AudioInputNode Component
- **Issue**: Audio Input node was rendering as white rectangle because component didn't exist
- **Root Cause**: Type `audioInput` defined in `packages/types/src/nodes.ts` but no component existed
- **Files Created**:
  - `apps/web/src/components/nodes/input/AudioInputNode.tsx`
- **Files Modified**:
  - `apps/web/src/components/nodes/input/index.ts` - Added export
  - `apps/web/src/components/nodes/index.ts` - Added import and registered in nodeTypes
- **Features**:
  - Upload audio files (MP3, WAV, etc.)
  - Audio player when file loaded
  - Displays filename and duration
  - Remove button to clear audio
  - URL input alternative
- **Pattern Used**: Followed VideoInputNode.tsx pattern exactly

#### 3. Implemented Auto-Layout Feature
- **Dependency Added**: `@dagrejs/dagre` in `apps/web/package.json`
- **Files Created**:
  - `apps/web/src/lib/autoLayout.ts` - Dagre-based layout utility
- **Files Modified**:
  - `apps/web/src/hooks/usePaneActions.ts` - Added `autoLayout` function
  - `apps/web/src/components/Toolbar.tsx` - Added auto-layout button (LayoutGrid icon)
  - `apps/web/src/components/context-menu/menus/paneMenu.tsx` - Added menu item
  - `apps/web/src/hooks/useContextMenu.ts` - Wired up autoLayout to context menu
- **Features**:
  - Left-to-right (LR) layout by default
  - Accessible via toolbar button or right-click context menu
  - Shortcut: `L` key
  - Auto fits view after layout

### Decisions Made

| Decision | Rationale |
|----------|-----------|
| AudioInputNode follows VideoInputNode pattern | Share similar data structure (file upload, URL input, duration display) |
| Auto-layout defaults to left-to-right (LR) | Most natural for workflow diagrams |
| Auto-layout button between panel toggles and file operations | Logical grouping with view-related actions |

### Files Summary

**Created:**
- `apps/web/src/components/nodes/input/AudioInputNode.tsx`
- `apps/web/src/lib/autoLayout.ts`

**Modified:**
- `apps/web/src/components/panels/NodePalette.tsx`
- `apps/web/src/components/nodes/input/index.ts`
- `apps/web/src/components/nodes/index.ts`
- `apps/web/package.json`
- `apps/web/src/hooks/usePaneActions.ts`
- `apps/web/src/components/Toolbar.tsx`
- `apps/web/src/components/context-menu/menus/paneMenu.tsx`
- `apps/web/src/hooks/useContextMenu.ts`

### Notes for Next Session

- Run `bun install` to install `@dagrejs/dagre` dependency
- Template node explanation: Creates reusable prompt templates with variables ({{product}}, {{style}}, etc.)
- Auto-layout supports 'TB' (top-bottom) direction as well, could add UI toggle if needed

### Patterns Established

1. **Input Node Pattern**: Follow VideoInputNode structure for file upload nodes
2. **Close Button Pattern**: Use `X` icon with `toggleX` from uiStore, styled as `p-1 hover:bg-[var(--secondary)] rounded transition`
3. **Toolbar Button Pattern**: Use `IconButton` component with tooltip
4. **Context Menu Pattern**: Add to menu options interface, pass handler via props

---

## Session 3: n8n Gap Analysis + socialPublish + rssInput Implementation

### Summary
Researched n8n content creation workflows to identify feature gaps in Genfeed, then implemented the approved priorities: added LinkedIn/Facebook/Threads to socialPublish and created a new rssInput node.

### Research Completed

#### n8n Workflow Analysis
- Reviewed 1,238+ content creation templates from [n8n workflows](https://n8n.io/workflows/categories/content-creation/)
- Identified key missing features compared to n8n capabilities
- Documented viral clip detection options (Vizard AI, Klap, DIY with Replicate)
- Saved full analysis to `/Users/decod3rs/.claude/plans/purrfect-dancing-bunny.md`

#### Key Findings
| n8n Feature | Genfeed Status |
|-------------|----------------|
| LinkedIn/Facebook/Threads publishing | **Now implemented** |
| RSS content curation | **Now implemented** |
| Viral clip detection (long-form → shorts) | Documented for later (Vizard/Klap/DIY) |
| Content scheduling | SaaS feature (later) |
| Approval workflows | Not yet |

### Tasks Completed

#### 1. Extended socialPublish with 3 New Platforms

**Files Modified:**

| File | Change |
|------|--------|
| `packages/types/src/nodes.ts:603-610` | Extended `SocialPlatform` type to include `linkedin`, `facebook`, `threads` |
| `packages/types/src/nodes.ts:1216` | Updated description to list all 7 platforms |
| `apps/web/src/components/nodes/output/SocialPublishNode.tsx:11-19` | Added 3 new platform buttons |
| `apps/web/src/components/nodes/output/SocialPublishNode.tsx:80` | Changed to 4-column grid layout for 7 buttons |

**Platform List (before → after):**
- Before: YouTube, TikTok, Instagram, Twitter
- After: YouTube, TikTok, Instagram, Twitter, **LinkedIn**, **Facebook**, **Threads**

#### 2. Created rssInput Node (New)

**Files Created:**

| File | Purpose |
|------|---------|
| `apps/web/src/components/nodes/input/RssInputNode.tsx` | Full UI component with URL/XML input modes, item navigation |
| `apps/web/src/app/api/rss/fetch/route.ts` | API endpoint that parses RSS 2.0 and Atom feeds |

**Files Modified:**

| File | Change |
|------|--------|
| `packages/types/src/nodes.ts:66` | Added `rssInput` to `NodeType` union |
| `packages/types/src/nodes.ts:152-166` | Added `RssFeedItem` interface and `RssInputNodeData` interface |
| `packages/types/src/nodes.ts:660` | Added `RssInputNodeData` to `WorkflowNodeData` union |
| `packages/types/src/nodes.ts:778-796` | Added `rssInput` to `NODE_DEFINITIONS` |
| `apps/web/src/components/nodes/BaseNode.tsx:26` | Added `Rss` icon import |
| `apps/web/src/components/nodes/BaseNode.tsx:59` | Added `Rss` to `ICON_MAP` |
| `apps/web/src/components/nodes/input/index.ts:4` | Added `RssInputNode` export |
| `apps/web/src/components/nodes/index.ts:14,39` | Added import and nodeTypes registration |

**rssInput Node Features:**
- URL mode: Paste RSS feed URL → fetch and parse
- XML mode: Paste raw XML → parse directly
- Supports both RSS 2.0 and Atom feed formats
- Item navigation with prev/next buttons
- Shows: feed title, item title, description, pub date
- Outputs text to connect to LLM node

### Decisions Made

| Decision | Rationale |
|----------|-----------|
| 4-column grid for platforms | 7 platforms too cramped in flex layout |
| rssInput follows tweetInput pattern | Consistent UX for text input nodes |
| Support both RSS 2.0 and Atom | Cover most common feed formats |
| Skip viral clip for now | Focus on publishing and content curation first |
| Document clip detection options | Vizard API has viral scoring, Klap is simpler, DIY with Replicate is possible but complex |

### Patterns Established

1. **New Input Node Pattern**: Follow TweetInputNode structure - dual mode (URL/text), fetch API, preview component
2. **Feed Parsing Pattern**: Regex-based XML parsing with CDATA extraction, supports multiple tag variants
3. **Platform Extension Pattern**: Update SocialPlatform type → update NODE_DEFINITIONS description → update UI component

### Future Reference: Viral Clip Detection

Documented three approaches for when ready to implement:

1. **Vizard AI API**: Has viral scoring (0-10), 30+ languages, Spark 1.0 video LLM
   - Docs: https://docs.vizard.ai/docs/introduction

2. **Klap API**: Simpler, per-operation pricing, 52 languages
   - Endpoint: `POST /tasks/video-to-shorts`
   - Docs: https://docs.klap.app/endpoints/tasks

3. **DIY with Replicate**:
   - Use `transcribe` → `video-llava` → `llama` scoring → FFmpeg
   - Models: `nateraw/video-llava`, `lucataco/qwen2.5-omni-7b`

### Sources Used
- [n8n Content Creation Workflows](https://n8n.io/workflows/categories/content-creation/)
- [n8n Social Media Workflows](https://n8n.io/workflows/categories/social-media/)
- [Vizard API Docs](https://docs.vizard.ai/docs/introduction)
- [Klap API Docs](https://docs.klap.app/endpoints/tasks)
