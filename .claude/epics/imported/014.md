---
name: "Comprehensive Test Coverage"
status: open
created: 2026-02-23T19:07:55Z
updated: 2026-02-25T21:03:22Z
github: https://github.com/genfeedai/core/issues/20
imported: true
labels:
  - enhancement
---

## Summary

Add 80-100% test coverage with mocked Replicate integration across both the NestJS API backend and Next.js web frontend.

## Key Deliverables

- Vitest setup for both API and Web apps
- Mocked Replicate SDK (backend) and MSW handlers (frontend)
- Unit tests for services, controllers, stores, and components
- Integration tests with mongodb-memory-server
- 80%+ coverage thresholds enforced

## Test Infrastructure

**API (apps/api):**
- `vitest.config.ts` - Vitest configuration with 80% coverage thresholds
- `src/test/setup.ts` - Global test setup with Replicate SDK mock
- `src/test/mocks/replicate.mock.ts` - Mock Replicate SDK responses
- `src/test/mocks/mongoose.mock.ts` - Mock Mongoose models and documents

**Web (apps/web):**
- `vitest.config.ts` - Vitest configuration with jsdom environment
- `src/test/setup.ts` - Global test setup with MSW server
- `src/test/mocks/handlers.ts` - MSW request handlers for all API endpoints
- `src/test/mocks/server.ts` - MSW server setup

## Test Cases (135 total)

**Backend Unit Tests:**
- `replicate.service.spec.ts` - 29 test cases
- `replicate.controller.spec.ts` - 11 test cases
- `executions.service.spec.ts` - 22 test cases
- `workflows.service.spec.ts` - 13 test cases
- `templates.service.spec.ts` - 14 test cases
- `app.controller.spec.ts` - 1 test case

**Frontend Unit Tests:**
- `workflowStore.test.ts` - 24 test cases
- `replicate.test.ts` - 11 test cases

**Integration Tests:**
- `workflow-execution.spec.ts` - 10 test cases

## Test Scripts

```bash
bun run test           # Run all tests
bun run test:api       # API tests only
bun run test:web       # Web tests only
bun run test:coverage  # Run with coverage
```

## Dependencies Added

**API:** vitest, @vitest/coverage-v8, supertest, mongodb-memory-server
**Web:** vitest, @vitest/coverage-v8, @testing-library/react, @testing-library/jest-dom, @testing-library/user-event, jsdom, msw
